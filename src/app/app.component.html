<div class="container">
  <!-- LEFT: Recipe editor -->
  <div class="card">
    <h2 class="section-title">Create / Edit Recipe</h2>
    <div class="row">
      <div>
        <label>Title</label>
        <input type="text" [formControl]="form.controls.title" placeholder="e.g. Sunday Pancakes" />
      </div>
      <div class="kv">
        <span class="v">Status</span>
        <span class="badge" *ngIf="form.value.id; else draft">Saved</span>
        <ng-template #draft><span class="badge">Draft</span></ng-template>
      </div>
    </div>

    <div class="hr"></div>

    <h3 class="section-title">Ingredients</h3>
    <div class="list">
      <div class="recipe-item" *ngFor="let ing of ingredients.controls; index as i">
        <div class="row">
          <div>
            <label>Name</label>
            <!-- $any() to satisfy strict template typing -->
            <input type="text" [formControl]="$any(ing.get('name'))" placeholder="e.g. Banana" />
          </div>
          <div class="flex" style="justify-content:flex-end; align-items:flex-end;">
            <button class="ghost" type="button" (click)="lookup(i)">Lookup nutrition</button>
            <button class="ghost" type="button" (click)="removeIngredient(i)">Remove</button>
          </div>
        </div>

        <div *ngIf="ing.value.nutrition as n; else noinfo" class="row-3">
          <div class="kv"><div>Carbs</div><div class="v">{{ n.carbs }}</div></div>
          <div class="kv"><div>Fat</div><div class="v">{{ n.fat }}</div></div>
          <div class="kv"><div>Protein</div><div class="v">{{ n.protein }}</div></div>
        </div>
        <ng-template #noinfo><small>No nutrition fetched yet.</small></ng-template>
      </div>
    </div>
    <div class="flex" style="margin-top:8px;">
      <button type="button" class="ghost" (click)="addIngredient()">+ Add ingredient</button>
    </div>

    <div class="hr"></div>

    <h3 class="section-title">Steps</h3>
    <div class="list">
      <div class="recipe-item" *ngFor="let s of steps.controls; index as i">
        <div class="row">
          <div>
            <label>Step {{ i + 1 }}</label>
            <textarea rows="2" [formControl]="$any(s)" placeholder="Describe the step..."></textarea>
          </div>
          <div class="flex" style="align-items:flex-end; justify-content:flex-end;">
            <button class="ghost" type="button" (click)="removeStep(i)">Remove</button>
          </div>
        </div>
      </div>
    </div>
    <div class="flex" style="margin-top:8px;">
      <button type="button" class="ghost" (click)="addStep()">+ Add step</button>
    </div>

    <div class="hr"></div>

    <div class="row">
      <div class="kv"><div>Total (from fetched items)</div>
        <div class="v">
          <span class="badge">Carbs: {{ totalMacros().carbs }}</span>
          <span class="badge">Fat: {{ totalMacros().fat }}</span>
          <span class="badge">Protein: {{ totalMacros().protein }}</span>
        </div>
      </div>
      <div class="flex" style="justify-content:flex-end;">
        <button type="button" (click)="saveRecipe()">Save Recipe</button>
        <button type="button" class="ghost" (click)="clearDraft()">Clear Draft</button>
      </div>
    </div>

    <div class="hr"></div>

    <div class="flex">
      <small *ngIf="loading()">Working...</small>
      <small *ngIf="info()">{{ info() }}</small>
      <small *ngIf="error()" style="color: var(--danger)">{{ error() }}</small>
    </div>
  </div>

  <!-- RIGHT: Saved recipes + API helpers (renamed section) -->
  <div class="card">
    <h2 class="section-title">Saved Recipes</h2>
    <div class="list" *ngIf="list().length; else norecipes">
      <div class="recipe-item" *ngFor="let r of list()">
        <div class="kv"><strong>{{ r.title }}</strong> <small class="v">{{ r.createdAt | date:'medium' }}</small></div>
        <div class="flex" style="justify-content:flex-end;">
          <button class="ghost" (click)="editRecipe(r)">Edit</button>
          <button class="warn" (click)="deleteRecipe(r)">Delete</button>
        </div>
      </div>
    </div>
    <ng-template #norecipes><small>No recipes saved yet.</small></ng-template>

    <div class="hr"></div>

    <h3 class="section-title">Ingredients (API)</h3>
    <div class="list">
      <button type="button" (click)="seedTwo()">Add ingredients</button>
      <button type="button" class="ghost" (click)="listRemote()">List ingredients</button>

      <div *ngIf="remote().length">
        <div class="hr"></div>
        <div class="list">
          <div class="kv" *ngFor="let n of remote()">
            <div>{{ n.name }}</div>
            <div class="v">C: {{ n.carbs }} | F: {{ n.fat }} | P: {{ n.protein }}</div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<footer>
  <small>Inputs persist automatically (localStorage). You can navigate away and come back â€” your draft stays.</small>
</footer>
